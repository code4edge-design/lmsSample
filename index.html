units<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>å­¦ç¿’è€…ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰</title>
  <style>
    /* ã“ã‚Œã‚’ <style> ã®å…ˆé ­ã€œæ—¢å­˜ã®ãƒ«ãƒ¼ãƒˆ/ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆå®šç¾©ã¨ç½®ãæ›ãˆ */
:root{
  --accent:#2563eb; --bar:#93c5fd; --text:#333; --bg:#f5f6fa; --muted:#64748b; --card:#fff;
  --hover:#3b82f6;
}

/* å¹…ã®ã‚ºãƒ¬é˜²æ­¢ï¼ˆpadding/ border ã‚’å¹…è¨ˆç®—ã«å«ã‚ã‚‹ï¼‰ */
*, *::before, *::after { box-sizing: border-box; }

html { font-size: 18px; }
body {
  margin:0;
  font-family:ui-sans-serif,system-ui,"Segoe UI",Roboto,"Noto Sans JP",sans-serif;
  background:var(--bg); color:var(--text);
  overflow-x:hidden; /* æ¨ªã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«æŠ‘æ­¢ */
}

/* ãƒ˜ãƒƒãƒ€ãƒ¼ã¯å·¦å³è©°ã‚ï¼‹2æ®µç›®æƒ…å ± */
header {
  background:#1e40af; color:#fff;
  padding:.9rem 1rem;
  display:flex; align-items:center; justify-content:space-between; gap:.75rem;
}
header h1 { margin:0; font-size:1.35rem; letter-spacing:.06em; }
.header-center { font-size:.95rem; color:#e0e7ff; text-align:center; flex:1; }
.header-right { font-size:.95rem; display:flex; gap:1rem; flex-wrap:wrap; }
.header-right strong{ font-weight:700; }

/* ã‚¹ãƒãƒ›å¹…ã§ã¯ã‚¿ã‚¤ãƒˆãƒ«ï¼ˆãƒ˜ãƒƒãƒ€ãƒ¼ã®ï¼‰ã¯éè¡¨ç¤º */
@media (max-width:640px){
  header h1{ display:none; }
  header{ flex-wrap:wrap; }
  .header-center, .header-right{ width:100%; text-align:left; }
}

/* ã‚³ãƒ³ãƒ†ãƒŠå¹…ã‚’ â€œç”»é¢å¹…ã®ã»ã¼ã„ã£ã±ã„â€ ã«ã—ã¤ã¤PCã§ã¯æœ€å¤§å¹…ã‚’åˆ¶é™ */
.container{
  width:min(100%, 1040px);                 /* ç”»é¢ãŒç‹­ã„æ™‚ã¯100%ã€åºƒã„æ™‚ã¯æœ€å¤§1040px */
  margin:clamp(8px, 2vw, 24px) auto;       /* ä¸Šä¸‹ã®ä½™ç™½ã‚’ãƒ‡ãƒã‚¤ã‚¹ã«åˆã‚ã›ã¦å¯å¤‰ */
  padding:clamp(8px, 2.4vw, 20px);         /* å†…å´ã®ä½™ç™½ã‚‚å¯å¤‰ã« */
}

/* æ±ç”¨ã‚«ãƒ¼ãƒ‰ */
.card{
  background:var(--card);
  border-radius:12px;
  box-shadow:0 2px 6px rgba(0,0,0,.08);
  padding:clamp(.9rem, 2.2vw, 1.2rem);
  border:2px solid transparent;
  transition:border-color .18s ease, box-shadow .18s ease, transform .18s ease;
}
.card.hoverable:hover{
  border-color:var(--hover);
  box-shadow:0 6px 16px rgba(59,130,246,.18);
  transform:translateY(-2px);
}

/* ç”»åƒã¯å¸¸ã«æ å†…ã«åã‚ã‚‹ */
img{ max-width:100%; height:auto; display:block; }

/* ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆï¼šä¸Šæ®µï¼ˆã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ï¼‹ã‚°ãƒ©ãƒ•ï¼‰ */
.top-grid{
  display:grid; gap:1.2rem; align-items:stretch;
  grid-template-columns: 1.05fr 1.35fr;
}
@media (max-width:900px){ .top-grid{ grid-template-columns:1fr; } }

/* ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ */
.calendar-header{ display:flex; align-items:center; justify-content:space-between; margin-bottom:.6rem; }
.calendar-title{ font-weight:700; color:#111; }
.weekday{ color:var(--muted); font-size:.9rem; text-align:center; }
.calendar{ display:grid; grid-template-columns: repeat(7, 1fr); gap:6px; margin-top:.4rem; }
.day{ background:#e5e7eb; text-align:center; padding:.6rem 0; border-radius:8px; font-size:.95rem; user-select:none; }
.day.muted{ background:#edf2f7; color:#94a3b8; }
.day.active{ background:#60a5fa; color:#fff; }

/* æˆç¸¾è€ƒæŸ»ï¼ˆæ¨ªä¸¦ã³ï¼‰ */
.exam-section { margin: 1.2rem 0 1.6rem; }
.exam-content{
  display:flex; align-items:center; gap:1.2rem;
  background:#fff; border-radius:12px; padding:1rem;
  border:2px solid transparent; cursor:pointer;
  transition:border-color .18s, box-shadow .18s, transform .18s;
  box-shadow:0 2px 6px rgba(0,0,0,.08);
}
.exam-content:hover { border-color:var(--hover); box-shadow:0 6px 14px rgba(59,130,246,.18); transform: translateY(-2px); }
.exam-image img{ max-width:360px; border-radius:10px; }
@media (max-width:700px){
  .exam-content{ flex-direction:column; text-align:center; }
  .exam-image img{ max-width:100%; }
}

/* ãƒ¦ãƒ‹ãƒƒãƒˆä¸€è¦§ï¼š4â†’2â†’1åˆ— */
.units{ display:grid; gap:1.1rem; grid-template-columns:repeat(4,1fr); margin-top:1rem; }
@media (max-width:1100px){ .units{ grid-template-columns:repeat(2,1fr); } }
@media (max-width:640px){ .units{ grid-template-columns:1fr; } }
.unit{
  background:var(--card); border-radius:12px; padding:1rem; text-align:center; cursor:pointer;
  transition:transform .2s, box-shadow .2s, border-color .18s;
  box-shadow:0 2px 6px rgba(0,0,0,.08); border:2px solid transparent;
}
.unit:hover{ transform:translateY(-3px); box-shadow:0 6px 18px rgba(0,0,0,.12); border-color:var(--hover); }
.unit h4{ margin:.3rem 0 .1rem; font-size:1.05rem; display:flex; align-items:center; justify-content:center; gap:.4rem; }
.unit .title-dot{ width:10px; height:10px; border-radius:50%; display:inline-block; }

/* å††ã‚°ãƒ©ãƒ•ï¼ˆãã‚‹ã£ã¨å›ã‚‹ç‰ˆï¼‰ */
.circle{
  position: relative; width: 140px; height: 140px; border-radius: 50%;
  background: #e5e7eb; margin:.2rem auto .5rem; display:flex; align-items:center; justify-content:center; overflow:hidden;
}
.circle .fill{ position:absolute; inset:0; border-radius:50%; clip: rect(0, 140px, 140px, 70px); background: var(--color, #2563eb); transform: rotate(0deg); transform-origin:center; }
.circle.animate .fill{ animation: spin 1.2s ease-out forwards; }
@keyframes spin { from{ transform: rotate(0deg); } to{ transform: rotate(var(--deg,0deg)); } }
.progress-text{ font-weight:800; font-size:1.05rem; color:#222; }
.unit p{ margin:.15rem 0; font-size:.9rem; color:#555; }
.test-status{ font-size:.9rem; margin-top:.3rem; }
.test-status.done{ color:#16a34a; }
.test-status.pending{ color:#c2410c; }

/* ã‚°ãƒ©ãƒ•ï¼ˆæ£’ï¼‹æŠ˜ã‚Œç·šï¼‰ */
.chart-legend{ display:flex; gap:14px; font-size:.95rem; color:#555; margin-bottom:.6rem; }
.legend-box{ width:14px; height:14px; border-radius:3px; display:inline-block; vertical-align:middle; margin-right:6px; }
.legend-bar{ background:var(--bar); }
.legend-line{ background:var(--accent); }
.chart-wrap{ position:relative; height:420px; }
canvas{ display:block; width:100%; height:100%; }
.tooltip{
  position:absolute; background:#111; color:#fff; padding:.45rem .6rem;
  border-radius:8px; font-size:.9rem; pointer-events:none; transform:translate(-50%,-120%);
  white-space:nowrap; box-shadow:0 4px 12px rgba(0,0,0,.2); opacity:0; transition:opacity .12s;
}
.tooltip.visible{ opacity:1; }

/* ã‚¹ãƒãƒ›æ™‚ã¯å°‘ã—å¤§ããè¦‹ãˆã‚‹ã‚ˆã†å…¨ä½“ã‚¹ã‚±ãƒ¼ãƒ«ã‚’æœ€é©åŒ– */
@media (max-width:480px){
  html{ font-size:16px; }            /* æ–‡å­—ã‚’å°‘ã—æŠ‘ãˆã‚‹ï¼æ¨ªå¹…ãŒåºƒãä½¿ãˆã‚‹ */
  .chart-wrap{ height:300px; }       /* ã‚°ãƒ©ãƒ•é«˜ã•ã‚‚èª¿æ•´ */
}

  </style>
</head>
<body>
<header>
  <div class="header-center" id="datetime"></div>
  <div class="header-right">
    <span>ID: <strong>learner001</strong></span>
    <span>åå‰: <strong>ã‚µãƒ³ãƒ—ãƒ«å¤ªéƒ</strong></span>
  </div>
</header>

<div class="container">

  <!-- å¤§è¦‹å‡ºã— -->
  <h1 style="font-size:2rem; font-weight:700; margin:0 0 1rem; color:#1e3a8a;">Learning Dashboard</h1>

  <!-- ã‚¢ãƒŠã‚¦ãƒ³ã‚¹ -->
  <div class="card announcement">
    <h3>ğŸ“¢ ãŠçŸ¥ã‚‰ã›</h3>
    <p>æˆç¸¾è€ƒæŸ»ã¯ 9/20ï¼ˆSatï¼‰10:00ã€œ18:00 ã«å®Ÿæ–½äºˆå®šã§ã™ã€‚å—é¨“ãƒ«ãƒ¼ãƒ«ã¯æˆç¸¾è€ƒæŸ»ãƒšãƒ¼ã‚¸ã‚’ã”ç¢ºèªãã ã•ã„ã€‚</p>
  </div>

  <!-- ä¸Šæ®µï¼šã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ + æ—¥åˆ¥å­¦ç¿’æ™‚é–“ãƒãƒ£ãƒ¼ãƒˆ -->
  <div class="top-grid">
    <!-- ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ -->
    <div class="card">
      <div class="calendar-header">
        <div class="calendar-title">2025å¹´ 9æœˆ</div>
        <div style="color:#94a3b8;font-size:.9rem">è¡¨ç¤ºã®ã¿</div>
      </div>
      <div class="calendar" id="weekday">
        <div class="weekday">æœˆ</div><div class="weekday">ç«</div><div class="weekday">æ°´</div>
        <div class="weekday">æœ¨</div><div class="weekday">é‡‘</div><div class="weekday">åœŸ</div><div class="weekday">æ—¥</div>
      </div>
      <div id="calendar" class="calendar"></div>
    </div>

    <!-- ãƒãƒ£ãƒ¼ãƒˆï¼ˆæ£’ï¼‹æŠ˜ã‚Œç·šï¼‹ãƒ›ãƒãƒ¼Tooltipï¼‰ -->
    <div class="card">
      <div class="chart-legend">
        <span><i class="legend-box legend-bar"></i>æ—¥åˆ¥å­¦ç¿’æ™‚é–“ï¼ˆhï¼‰</span>
        <span><i class="legend-box legend-line"></i>æ—¥åˆ¥å­¦ç¿’æ™‚é–“ï¼ˆæŠ˜ã‚Œç·šï¼‰</span>
      </div>
      <div class="chart-wrap">
        <canvas id="studyChart"></canvas>
        <div id="tooltip" class="tooltip"></div>
      </div>
    </div>
  </div>

  <!-- æˆç¸¾è€ƒæŸ»ï¼šç”»åƒï¼‹å³å´ãƒ†ã‚­ã‚¹ãƒˆã®æ¨ªä¸¦ã³ï¼ˆå…¨ä½“ã‚¯ãƒªãƒƒã‚¯ã§ exam.htmlï¼‰ -->
  <section class="exam-section">
    <div class="exam-content" onclick="window.location.href='exam.html'">
      <div class="exam-image">
        <img src="Designer.jpeg" alt="æˆç¸¾è€ƒæŸ»">
      </div>
      <div class="exam-text">
        <h2>æˆç¸¾è€ƒæŸ»</h2>
        <p class="exam-next">æ¬¡å›æˆç¸¾è€ƒæŸ»ã¯ <strong>9/30</strong> ã§ã™ã€‚</p>
        <p class="exam-desc">å—é¨“çŠ¶æ³ã‚„çµæœã‚’ç¢ºèªã§ãã¾ã™</p>
      </div>
    </div>
  </section>

  <!-- ãƒ¦ãƒ‹ãƒƒãƒˆä¸€è¦§ -->
  <h2 style="margin:.5rem 0 0.6rem;">ãƒ¦ãƒ‹ãƒƒãƒˆä¸€è¦§ï¼ˆæ–°ã—ã„é †ï¼‰</h2>
  <div id="units" class="units"></div>
</div>

<script>
  /* ===== ç¾åœ¨æ—¥æ™‚ï¼ˆãƒ˜ãƒƒãƒ€ãƒ¼ä¸­å¤®ï¼‰ ===== */
  function updateDateTime() {
    const now = new Date();
    const opt = { year:'numeric', month:'2-digit', day:'2-digit', hour:'2-digit', minute:'2-digit', second:'2-digit' };
    document.getElementById("datetime").textContent = now.toLocaleString('ja-JP', opt);
  }
  setInterval(updateDateTime, 1000); updateDateTime();

  /* ===== 2025-09 ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ï¼ˆè¡¨ç¤ºã®ã¿ï¼‰ ===== */
  const daysInMonth = 30;
  const studied = Array.from({length:daysInMonth}, (_,i)=> (i%2===0 ? 1 : 0)); // ãƒ€ãƒŸãƒ¼ï¼šå¶æ•°æ—¥ã ã‘å­¦ç¿’ã‚ã‚Š
  const calEl = document.getElementById('calendar');
  const first = new Date(2025, 8, 1); // 2025-09-01
  const firstWeekday = (first.getDay()+6)%7; // æœˆ=0..æ—¥=6
  const totalCells = firstWeekday + daysInMonth;
  const rows = Math.ceil(totalCells/7);
  for(let r=0; r<rows; r++){
    for(let c=0; c<7; c++){
      const idx = r*7 + c;
      const dateNum = idx - firstWeekday + 1;
      const cell = document.createElement('div');
      if(dateNum < 1 || dateNum > daysInMonth){
        cell.className = 'day muted'; cell.textContent = '';
      }else{
        cell.className = 'day' + (studied[dateNum-1] ? ' active' : '');
        cell.textContent = String(dateNum);
      }
      calEl.appendChild(cell);
    }
  }

  /* ===== ãƒ¦ãƒ‹ãƒƒãƒˆä¸€è¦§ï¼ˆè‰²åˆ†ã‘ãƒ»é€²æ—ï¼…ä¸‹ãƒ»ç‹å† ãƒ»ãƒ†ã‚¹ãƒˆçŠ¶æ…‹ï¼‰ ===== */
  const palette = ['#2563eb','#16a34a','#d97706','#dc2626','#7c3aed','#0ea5e9','#059669'];
  const units = [
    { id:4, title:"ãƒ¦ãƒ‹ãƒƒãƒˆ4: å®Ÿè·µç·¨", desc:"ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰çµ±åˆ", date:"2025-03-01", watched: 14.5, testTaken:false },
    { id:3, title:"ãƒ¦ãƒ‹ãƒƒãƒˆ3: ç™ºå±•ç·¨", desc:"APIã¨DB",            date:"2025-02-15", watched: 20.0, testTaken:true  },
    { id:2, title:"ãƒ¦ãƒ‹ãƒƒãƒˆ2: å¿œç”¨ç·¨", desc:"Webã‚¢ãƒ—ãƒªåŸºç¤",     date:"2025-01-10", watched: 5.0,  testTaken:false },
    { id:1, title:"ãƒ¦ãƒ‹ãƒƒãƒˆ1: åŸºç¤ç·¨", desc:"ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°å…¥é–€", date:"2024-12-01", watched: 20.0, testTaken:true  }
  ].sort((a,b)=> new Date(b.date)-new Date(a.date));
  const unitsEl = document.getElementById('units');

  units.forEach((u, i)=>{
  const percent = Math.min(100, Math.round((u.watched/20)*100));
  const color = palette[i % palette.length];

  const card = document.createElement('div');
  card.className = 'unit';
  card.onclick = () => window.location.href = `unit.html?id=${u.id}`;

  const crown = percent>=100 ? 'ğŸ‘‘' : '';
  const testClass = u.testTaken ? 'done' : 'pending';
  const testText  = u.testTaken ? 'å—é¨“æ¸ˆã¿' : 'æœªå—é¨“';

  card.innerHTML = `
    <div class="circle-svg">
      <svg viewBox="0 0 120 120" width="140" height="140">
        <!-- èƒŒæ™¯ã‚°ãƒ¬ãƒ¼å†† -->
        <circle cx="60" cy="60" r="54" stroke="#e5e7eb" stroke-width="12" fill="none" />
        <!-- é€²æ—ã‚«ãƒ©ãƒ¼å†† -->
        <circle 
          class="progress" 
          cx="60" cy="60" r="54" 
          stroke="${color}" 
          stroke-width="12" 
          fill="none"
          stroke-linecap="round"
          stroke-dasharray="${2 * Math.PI * 54}"
          stroke-dashoffset="${2 * Math.PI * 54}"
        />
      </svg>
      <div class="progress-text">${percent}%</div>
    </div>
    <h4><span class="title-dot" style="background:${color}"></span>${u.title} ${crown}</h4>
    <p>${u.desc}</p>
    <p>å…¬é–‹æ—¥: ${u.date}</p>
    <div class="progress-text">${percent}%ï¼ˆ${u.watched.toFixed(1)}h / 20hï¼‰</div>
    <div class="test-status ${testClass}">ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆï¼š${testText}</div>
  `;
  unitsEl.appendChild(card);

  // å††ã‚°ãƒ©ãƒ•ã‚’ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã§æç”»
  const circle = card.querySelector(".progress");
  const length = 2 * Math.PI * 54;
  setTimeout(()=>{
    circle.animate([
      { strokeDashoffset: length },
      { strokeDashoffset: length * (1 - percent/100) }
    ], {
      duration: 1500,
      easing: "ease-out",
      fill: "forwards"
    });
  }, 200 + i*200);
});

  /* ===== æ—¥åˆ¥å­¦ç¿’æ™‚é–“ã‚°ãƒ©ãƒ•ï¼ˆæ£’ï¼‹æŠ˜ã‚Œç·šï¼‹ãƒ„ãƒ¼ãƒ«ãƒãƒƒãƒ—ï¼‹ã‚¢ãƒ‹ãƒ¡ï¼‰ ===== */
  const studyHours = Array.from({length: daysInMonth}, (_,i)=>{
    const d = new Date(2025, 8, i+1);
    const w = d.getDay(); // Sun=0
    let base = (w===0 || w===6) ? Math.random()*2.0 : 1 + Math.random()*3.0;
    return +base.toFixed(1);
  });

  const canvas = document.getElementById('studyChart');
  const tooltip = document.getElementById('tooltip');
  const ctx = canvas.getContext('2d');
  let layoutCache = null;
  let animStart = null;
  let animProgress = 0;

  function resizeCanvas(){
    const dpr = Math.min(window.devicePixelRatio || 1, 2);
    const parent = canvas.parentElement;
    const w = parent.clientWidth;
    const h = parent.clientHeight;
    canvas.style.width = w + 'px';
    canvas.style.height = h + 'px';
    canvas.width = Math.floor(w * dpr);
    canvas.height = Math.floor(h * dpr);
    ctx.setTransform(dpr,0,0,dpr,0,0);
    // ãƒªã‚µã‚¤ã‚ºæ™‚ã¯å†ã‚¢ãƒ‹ãƒ¡é–‹å§‹
    animStart = null; animProgress = 0;
    requestAnimationFrame(drawChartAnim);
  }
  window.addEventListener('resize', resizeCanvas);

  function drawChartAnim(timestamp){
    if(!animStart) animStart = timestamp;
    animProgress = Math.min((timestamp - animStart) / 1200, 1); // 1.2ç§’
    drawChart(animProgress);
    if(animProgress < 1) requestAnimationFrame(drawChartAnim);
  }

  function drawChart(progress=1){
    const w = canvas.clientWidth, h = canvas.clientHeight;
    ctx.clearRect(0,0,w,h);

    const pad = { left: 48, right: 18, top: 18, bottom: 34 };
    const xCount = studyHours.length; // 30
    const maxY = Math.max(4, Math.ceil(Math.max(...studyHours)*1.1));
    const x0 = pad.left, y0 = h - pad.bottom;
    const plotW = w - pad.left - pad.right;
    const plotH = h - pad.top - pad.bottom;

    // ã‚°ãƒªãƒƒãƒ‰
    ctx.strokeStyle = '#cbd5e1'; ctx.lineWidth = 1;
    ctx.beginPath();
    for(let y=0; y<=maxY; y++){
      const yy = y0 - plotH*(y/maxY);
      ctx.moveTo(x0, yy); ctx.lineTo(x0 + plotW, yy);
    }
    ctx.stroke();

    // ãƒ©ãƒ™ãƒ«
    ctx.fillStyle = '#475569';
    ctx.font = '12.5px system-ui';
    ctx.textAlign = 'right'; ctx.textBaseline = 'middle';
    for(let y=0; y<=maxY; y++){
      const yy = y0 - plotH*(y/maxY);
      ctx.fillText(String(y), x0-8, yy);
    }
    ctx.textAlign = 'center'; ctx.textBaseline = 'top';
    for(let i=0;i<xCount;i++){
      if(i%5!==0 && i!==xCount-1) continue;
      const xx = x0 + (plotW*(i+0.5)/xCount);
      ctx.fillText(`9/${i+1}`, xx, y0+8);
    }

    // æ£’ï¼ˆã‚¢ãƒ‹ãƒ¡ï¼šå€¤ã«progressã‚’æ›ã‘ã‚‹ï¼‰
    const barGap = 4;
    const barW = Math.max(4, (plotW / xCount) - barGap);
    ctx.fillStyle = getComputedStyle(document.documentElement).getPropertyValue('--bar').trim() || '#93c5fd';
    for(let i=0;i<xCount;i++){
      const v = studyHours[i] * progress;
      const x = x0 + (plotW * i / xCount) + barGap/2;
      const hPx = plotH * (v / maxY);
      const y = y0 - hPx;
      ctx.fillRect(x, y, barW, hPx);
    }

    // æŠ˜ã‚Œç·šï¼ˆã‚¢ãƒ‹ãƒ¡ï¼šå€¤ã«progressã‚’æ›ã‘ã‚‹ï¼‰
    ctx.strokeStyle = getComputedStyle(document.documentElement).getPropertyValue('--accent').trim() || '#2563eb';
    ctx.lineWidth = 2;
    ctx.beginPath();
    for(let i=0;i<xCount;i++){
      const v = studyHours[i] * progress;
      const xx = x0 + (plotW*(i+0.5)/xCount);
      const yy = y0 - plotH*(v/maxY);
      if(i===0) ctx.moveTo(xx,yy); else ctx.lineTo(xx,yy);
    }
    ctx.stroke();

    // ç‚¹
    ctx.fillStyle = ctx.strokeStyle;
    for(let i=0;i<xCount;i++){
      const v = studyHours[i] * progress;
      const xx = x0 + (plotW*(i+0.5)/xCount);
      const yy = y0 - plotH*(v/maxY);
      ctx.beginPath(); ctx.arc(xx,yy,3.5,0,Math.PI*2); ctx.fill();
    }

    layoutCache = { x0, y0, plotW, plotH, maxY, xCount };
  }

  // ãƒ„ãƒ¼ãƒ«ãƒãƒƒãƒ—ï¼ˆã‚¢ãƒ‹ãƒ¡ä¸­ã‚‚ç¾åœ¨ã®å€¤ã§è¡¨ç¤ºï¼‰
  canvas.addEventListener('mousemove', (e)=>{
    if(!layoutCache) return;
    const rect = canvas.getBoundingClientRect();
    const x = e.clientX - rect.left;
    const { x0, plotW, xCount, maxY, y0, plotH } = layoutCache;
    if (x < x0 || x > x0+plotW) { tooltip.classList.remove('visible'); return; }

    const rel = (x - x0) / plotW;
    let idx = Math.round(rel * xCount - 0.5);
    idx = Math.max(0, Math.min(xCount-1, idx));

    const v = studyHours[idx] * Math.max(animProgress, 0.001);
    const xx = x0 + (plotW*(idx+0.5)/xCount);
    const yy = y0 - plotH*(v/maxY);

    tooltip.textContent = `9/${idx+1} : ${v.toFixed(1)}h`;
    tooltip.style.left = (xx) + 'px';
    tooltip.style.top  = (yy) + 'px';
    tooltip.classList.add('visible');
  });
  canvas.addEventListener('mouseleave', ()=> tooltip.classList.remove('visible'));

  // åˆæœŸæç”»ï¼†ã‚¢ãƒ‹ãƒ¡é–‹å§‹
  (function init(){
    // ã‚«ãƒ³ãƒã‚¹åˆæœŸåŒ–
    const dpr = Math.min(window.devicePixelRatio || 1, 2);
    const parent = canvas.parentElement;
    canvas.style.width = parent.clientWidth + 'px';
    canvas.style.height = parent.clientHeight + 'px';
    canvas.width = Math.floor(parent.clientWidth * dpr);
    canvas.height = Math.floor(parent.clientHeight * dpr);
    ctx.setTransform(dpr,0,0,dpr,0,0);
    requestAnimationFrame(drawChartAnim);
  })();
</script>
</body>
</html>
